<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Shade Map Output - The Bentway</title>
    <!--<link rel="canonical" href="link">-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Shade Map - The Bentway">
    <meta property="og:description" content="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas congue, arcu a ornare dictum, nisl neque aliquet est, et ultricies arcu mauris vel velit. Curabitur porta feugiat imperdiet. Duis id turpis scelerisque, cursus mauris iaculis, tempus orci. Nulla ornare eu augue nec pharetra. 
      Aliquam erat volutpat. Suspendisse sagittis venenatis enim, eget porta nibh malesuada ut. Nullam feugiat euismod leo nec congue. Vivamus aliquet tellus pharetra massa rutrum convallis. Integer posuere massa nec iaculis ullamcorper. Curabitur ligula nunc, tincidunt ac lorem facilisis, euismod feugiat tellus. In et consequat augue. 
      Etiam fermentum nibh nisi, vitae mattis dolor consequat vitae.">
    
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
       
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css"
    />

    <style>
      html, body { height: 100%; margin: 0; padding: 0; }
      #controls { height: 40px; background: #f8f8f8; display: flex; align-items: center; padding: 0 1rem; font-family: sans-serif; }
      #map { height: calc(100% - 40px); }
      .leaflet-popup-content { font-family: sans-serif; font-size: 14px; line-height: 1.4; }
    </style>
    
  </head>
  <body>
    <main>
      <div id="controls">
        <span id="status"></span>
      </div>
      < div id="map"></div>
    </main>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const map = L.map('map').setView([43.637869, -79.406311], 13);
        const statusEl = document.getElementById('status');

        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
          attribution:
            '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
        }).addTo(map);

        L.Control.geocoder({
          defaultMarkGeocode: false
        })
        .on('markgeocode', e => map.setView(e.geocode.center, 16))
        .addTo(map);

        function renderMarkers() {
          Papa.parse('https://raw.githubusercontent.com/angel-girl212/shademap2/refs/heads/main/july8_responses.csv', {
            download: true,
            header: true,
            dynamicTyping: true,
            skipEmptyLines: true,
            complete: results => {
              const data = results.data
                .filter(r => Number.isFinite(r.latitude) && Number.isFinite(r.longitude))
                .sort((a, b) => a.longitude - b.longitude || b.latitude - a.latitude);

              data.forEach((pt, idx) => {
                const baseLat = pt.latitude;
                const baseLng = pt.longitude;
                const markerName = pt.name; // will be undefined if undefined

                const marker = L.marker([baseLat, baseLng]).addTo(map);
                marker.bindPopup(`<b>${markerName}</b><br>${baseLat.toFixed(6)}, ${baseLng.toFixed(5)}`);
              });
            },
            error: err => {
              console.error(err);
              if (typeof statusEl !== 'undefined') {
                statusEl.textContent = 'Failed to load CSV';
              }
            }
          });
        }

        renderMarkers();
      });
    </script>
  </body>
</html>
